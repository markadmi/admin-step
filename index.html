<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <title>دخول الرئيس 👑</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style/owner.css">
</head>
<body style="background:#000; color:#fff;">
  <div class="owner-container">
    <div class="owner-card" style="background:#111; border:1px solid gold; border-radius:16px; padding:20px; max-width:400px; margin:100px auto;">
      <h1 style="color:gold;">👑 دخول الرئيس</h1>
      <p>أدخل اسمك وارفع صورتك لتبدأ إدارة الدردشة.</p>

      <label>الاسم</label>
      <input id="ownerName" type="text" placeholder="اسم الرئيس">

      <label>صورتك (اختياري)</label>
      <input id="ownerAvatar" type="file" accept="image/*">

      <button id="enterOwner" class="btn" style="margin-top:10px; background:gold; color:#000; font-weight:bold; padding:8px 14px; border:none; border-radius:8px;">دخول كرئيس</button>

      <div id="info" class="info" style="margin-top:10px; color:#aaa;"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref as dbRef, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getStorage, ref as storageRef, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    // إعداد Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCzokitueX9Ph_LNUekRpG0MZxpPkgcEiQ",
      authDomain: "hacker-withdraw-photos.firebaseapp.com",
      databaseURL: "https://hacker-withdraw-photos-default-rtdb.firebaseio.com",
      projectId: "hacker-withdraw-photos",
      storageBucket: "hacker-withdraw-photos.appspot.com",
      messagingSenderId: "295892241734",
      appId: "1:295892241734:web:01b7841226bc8b189b2947",
      measurementId: "G-QE2VCZY3NX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    // عناصر الصفحة
    const nameEl = document.getElementById('ownerName');
    const avatarEl = document.getElementById('ownerAvatar');
    const btn = document.getElementById('enterOwner');
    const info = document.getElementById('info');

    function setInfo(txt) { info.innerText = txt; }

    btn.addEventListener('click', async () => {
      const name = nameEl.value.trim();
      const file = avatarEl.files[0];
      if (!name) return alert('يرجى إدخال الاسم.');

      setInfo('جارٍ تجهيز حسابك...');

      let avatarUrl = 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png'; // صورة افتراضية
      try {
        if (file) {
          const reader = new FileReader();
          reader.onload = async (e) => {
            const dataUrl = e.target.result;
            const path = `owners/${Date.now()}.png`;
            const sRef = storageRef(storage, path);
            await uploadString(sRef, dataUrl, 'data_url');
            avatarUrl = await getDownloadURL(sRef);
            await saveOwner(name, avatarUrl);
          };
          reader.readAsDataURL(file);
        } else {
          await saveOwner(name, avatarUrl);
        }
      } catch (err) {
        console.error(err);
        setInfo('حدث خطأ أثناء الدخول.');
      }
    });

    async function saveOwner(name, avatarUrl) {
      const userRef = push(dbRef(db, 'owners'));
      await set(userRef, {
        name,
        avatarUrl,
        role: 'رئيس',
        joinedAt: Date.now()
      });

      const session = {
        userKey: userRef.key,
        name,
        avatarUrl,
        role: 'رئيس'
      };
      localStorage.setItem('chat_session', JSON.stringify(session));
      window.location.href = 'owner-chat.html';
    }

    // لو جلسة رئيس موجودة مسبقاً
    const s = localStorage.getItem('chat_session');
    if (s) {
      const sess = JSON.parse(s);
      if (sess.role === 'رئيس') {
        window.location.href = 'owner-chat.html';
      }
    }
  </script>
</body>
</html>
